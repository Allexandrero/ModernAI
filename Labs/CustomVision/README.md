# Custom Vision Lab

В этой лабораторной работе мы научимся распознавать разные категории изображений с использованием [Custom Vision API](https://docs.microsoft.com/en-us/azure/cognitive-services/custom-vision-service/).

## Придумайте себе задачу

Custom Vision API может научиться распознавать разные классы изображений, например, разные предметы, на достаточно небольшом наборе
примеров. При этом изображения должны быть достаточно четкими, крупными, и различимыми. Попытка натренировать Custom Vision на небольшие
объекты в кадре как правило не приводит к хорошим результатам.

Исходя из этого, придумайте задачу, для которой можно легко найти в интернет 20-30 однотипных изображений для каждого класса объектов.
Хорошими примерами таких задач будут:

1. Распознавание вида газировки: Fanta, Cola, Sprite
2. Распознавание логотипов крупных брендов: Microsoft, Intel, Google
3. Распознавание типа одежды в магазине
4. Отличение разных видов животных
5. Распознавание электронных компонентов
6. ...

## Получаем обучающие изображения

Для автоматического скачивания изображений из топовых результатов Bing Search можно воспользоваться утилитой [imdownload.exe](./imdownload.zip?raw=true).
Скачайте zip-файл и распакуйте его в какую-нибудь директорию.
Формат вызовы утилиты:
```
imdownload <bing key> "<search term>" [<image mask with #> <number of images>]
```
Для использования необходим ключ для использования Bing Search API - его можно получить [вот на этой странице](https://azure.microsoft.com/en-us/try/cognitive-services/?api=bing-web-search-api)
или через свою облачную подписку (создав объект Cognitive Services -> Search). Для мероприятий вы можете попробовать использовать следующий
код: `46e12b3bfaa042128641ce04f72f7bbc`.

Например, для скачивания картинок с чёрными кошками, используем
```
imdownload xxxxxx "Yellow Cat" Cat# 30
```

После скачивания всех изображений необходимо:

 * просмотреть их и удалить неудачные изображения
 * отложить некоторое количество (2-5) изображений разных категорий для проверки

## Тренируем модель

Для создания модели распознавания заходим на сайт http://customvision.ai и выполняем следующие шаги:

1. Выбираем пункт **New Project** и создаём новый проект по распознаванию
2. По-очереди для каждой категории изображений загружаем их и присваиваем соответствующий тег
3. Нажимаем Train Model и наблюдаем значения precision и recall. Эти значения показывают качество обучения модели (чем больше - тем лучше), и позволяют оценивать количество ошибок первого и второго рода
4. Для тестирования модели выбираем *Quick Test* и загружаем отложенные нами ранее тестовые изображения.

## Проверка модели через телеграм-бота

Для возможности проверки модели в "реальных условиях" вы можете воспользоваться специальным телеграм-ботом `@MyCustomVisionBot`. Для этого
в панели управления Custom Vision Service выбираем `Performance -> Prediction Url`. На этой странице смотрим на следующую информацию:

* URL сервиса, которая выглядит примерно так: `https://southcentralus.api.cognitive.microsoft.com/customvision/v1.0/Prediction/xxxxxx-xxxx-xxxx-xxxx-xxxxx/url`
* Prediction Key (последовательность букв и цифр)

Первым делом вам нужно послать боту строчку, состоящую из идентификатора модели (строка вида `xxxxxx-xxxx-xxxx-xxxx-xxxxx`) и prediction key, разделенных
пробелом. После этого, вы сможете посылать боту фотографии, которые он будет пытаться распознать. Это удобно делать с телефона, одновременно
фотографируя предметы.

По умолчанию бот настроен на распознавание логотипов Coca-Cola, Fanta, Sprite, Microsoft, Intel, Starbucks и некоторых других.
